---
title: 数据库（机电）结课报告
date: 2024-04-14 16:26:40
tags:
  - 报告
  - 数据库
  - rust
---

<!-- # 结课报告 -->

## 摘要

欢迎访问 <http://8.148.20.227:3000/> 查看项目成果，使用了的阿里服务器所以可以直接公网访问。计划在5月14号关闭。整个系统还有很多不足之处，但我相信我已经在有限的时间内做到了最好。数据库部分的软件完全由我自己开发，网站使用`nuxt`框架，具体代码也由我一人开发。

## 数据库部分

这部分可以说几乎与结课要求有些偏差，但我认为`mysql`在数据库开发上以及有些落后了。现在的设计上有很多新的技术和理念能够带来更好的效果。问题在于应用场景，对于小规模应用，`mysql`功能庞杂有很多臃肿，对于大规模应用，社区的一致意见是`mysql`的性能很差。这其中其实不存在中间部分，有更加优秀的软件也能替代。在我们通信专业和计算机学院都需要开一门课来讲授如何使用`mysql`，据我观察大部分同学在课后也无法独立解决遇到的问题，而现在的大部分主流数据库在大部分应用场景下是无须学习的。

所以，我自己尝试编写了一个能满足本次课程要求的所谓数据库软件。代码位于：<https://github.com/nan-mu/codecrafters-redis-rust>

> 在完整掌握了这部分内容后，我认为数据库软件是个伪概念，这部分软件实际上是作为状态管理器使用的。

具体实现可以分为三部分，一是实现直接的数据存储功能，例如保存，提取，查询；具体代码位于`src/darabase.rs`。二是实现数据类型（也可以说是表）的相关操作，例如显示，设置主键和从其他类型转换等功能；具体代码位于`src/structs/mod.rs`。最后是与外部程序通信的协议等实现，具体代码位于`src/main.rs`和`src/distribute.rs`。

软件初始化时间差不多在`700ms`左右，运行平台是阿里云最便宜的经济性`ecs`。在调试过程中CPU利用率不超过2%，没有时间做更多的测试。

数据存储方面使用两个`hashmap`存储具体数据和功能标签，`rust`的所有数据结构按照C语言的理解天生只能使用指针访问，所以直接存储即可，但访问查询时再将整个`hashmap`拿出来就不太高效，所以使用另一个`hashmap`存储结构信息。在数据操作到来时向查找小表，再操作大表。整体以上的数据结构和操作封装在一个对象中，使用时将这个对象套一个指针和互斥锁，实现异步操作。

程序接口方面使用`redis`通信协议，本质上是通过`tcp`传递数据帧。`tcp`实现使用`rust`的异步库`tokio`，主线程阻塞地等待连接，连接到来时分发异步会话，异步库能够根据同步代码自动分配线程，这应该是最先进的多线程设计，但也有好几年了。

实际业务逻辑代码952行，总计55次提交。

## 网站部分

这部分内容可以说会更麻烦一些，在开发前期有很多时间花在了验证上面。我所有的开发工作都在`linux`上进行，这带来了很多遍历也有很多后果。最开始我希望趁这个机会尝试下安卓开发，可似乎安卓的工具链会高度依赖Android Studio，而一直因为很多奇怪的问题没有跑通它的example。具体内容提交了issue <https://github.com/flutter/flutter/issues/146390，似乎还被认为重复了，实际上我认为问题出在C语言的编译工具链上。但我没时间做深入的研究了。>

第二个想法时尝试编写一个桌面端应用，一直想试试大名鼎鼎的`tauri`，在上大学之前我主要的学习方向就是前端偏全栈开发，当时应该是`electron`发布第二个大版本更新，这期间接触到了`tauri`，据说是使用`rust`提供高性能计算支持，以此为契机将学习方向转为`rust`方向。而尝试`tauri`还是除了问题，也提了issue <https://github.com/tauri-apps/tauri/issues/9404，但最近`tauri`正在更新beta通道的第二个大版本，也没人有空处理了，初步判断可能和国内特殊的网络环境有关。>

所以兜兜转转还是回到了网络开发上，开发时使用`nuxt`，这是一个`vue`版本的`next`。能够提供服务器`api`，整合`vue`的组件，路由也支持`vitw`构建，提供了`SSR`渲染（基于node服务器`Nitro`）。我已经很久不关注前端的一些技术动态了，但这应该是3年以来较为广泛应用的Web应用框架。整体开发算是比较舒畅。我记得最开始学习时前端最流行的说法是静态为王，这很好，抛弃了所谓的动态语言，让用户的浏览器分担计算任务。而现在为了开发简便我们又回到了`SSR`，但我认为还是没有回到的当时的服务端渲染，毕竟这些06年的技术比起如今也有近20年的代差。实际体验下来所谓的`SSR`实际上仅仅只是在路由和`api`方面的优化，服务端提供更加简单的路由操作使得我们不用手动设置`api`静态资源等问题。比如我们想使用一个字体文件，我只需要安装字体的`cdn`包，然后写点`css`，剩下程序会将字体自动划分按需加载文件，引入也是自动的。

总体来说，主要的实现在两个方面，一个是组件开发，具体代码为`app.vue`和`pages/*.vue`。二是`api`开发，用于和数据库通信，具体代码为`server/api/*.ts`。

实际业务逻辑代码533行，总计28次提交。

## 结语

这个报告会看起来非常概括，毕竟没有包含任何图片和代码。我希望具体的内容能请读者自己到网站上看一看。

总的来说这次有很多遗憾，很多想实现的内容没来得及实现，但我的情况一直都这样。但我觉得其他同学更加可悲，大家没有基础就去做这样一个内容，很多人非常痛苦。在大一时我想和同学们一起做一些东西，结果大家这不会那不会，那花时间学吗？可真正一算是真没有时间，大家的时间要花在考试作业上，专业课尚且不论，但工程中的很多东西我认为是不能这样教的。

网上之前有个笑话，说之前没好好打游戏现在上了大学电脑都不会用。这是真存在的，我身边的很多男性朋友普遍存在游戏大的多计算机的一些使用就掌握的好，很多女同学从一开始就没接触过这些东西，打游戏喜欢装模组的就能很轻松的掌握工具链的安装，喜欢完策略游戏的能轻松地掌握`IDE`界面的很多工具，想和朋友联机的会了解服务器相关知识。所有人都知道加速器是什么，代理大概是什么原理。而女同学在这一方面吃了很多亏。我认为这是很搞笑的，这些本应该是学校教授的内容，但国内大部分是学生自发自学，更的可怕是很多大学相关专业老师的也不了解这些东西。有趣的是现在可以找到很多外国大学的课程，他们教`git`，教计算机的基本概念。我曾听说我们学院曾经有一门叫做计算机文化的课程，我认为这应该放到教授编程语言之前，好好和大家讲一讲这些东西。但每个大学生都有一台电脑时，专业上回避这个问题就是极度的不负责。

在社会上人们有充足的时间和实践以此不断发展技术，而学校里的学生没有时间却全是实践，因为分了专业也没有明确的分工，假如一个将来要做嵌入式工程师，大学4年会花2年的时间作这之外的事，这其中不包括转向或者验证，这是从课程安排上得出而不是有这个假设。

大家什么都要学自然就没了时间，即使大家想学，也没人能教。而现在就是恶果，不管是985还是211，大家一份代码传3代（比如我们学院的一些比赛，我确认过）（比如上个月结束的机甲大师，从朋友处听来武汉理工和华科都有这个问题）。技术进步只发生在淘宝店上，很多竞赛与其说在展示学生水平不如说是展示淘宝店的水平，与其做好一件事，不如选好一家淘宝店；与其努力攻克一个难题，不如狠下心多花钱。这样的教学安排，从统计上来说，必然会让大部分人与技术隔绝开来。

写这么多是因为在开发期间有很多同学来和我讨论如何完成这个作业，而大家面对这个问题时遇到很多痛苦，这不是问题带来的，而是落后带来的。面对这个问题，我觉得没有很好的解决方法。况且近期有一些研究生揭露学校老师的新闻。我想他们在无可奈何走向这条路之前是不是也遇到这种问题。
